USE GD1C2023

--------------------------- Creacion del schema --------------------------- 
-- CREATE schema ??

--------------------------- Creacion de tablas ---------------------------- 

CREATE TABLE Usuario(
--	usuario_id decimal(18,0) IDENTITY PRIMARY KEY,
	usuario_dni decimal(18,0) IDENTITY PRIMARY KEY,
	usuario_nombre nvarchar(255) NULL,
	usuario_apellido nvarchar(255) NULL,
	usuario_mail nvarchar(255) NULL,
	usuario_direccion decimal(18,0) FOREIGN KEY REFERENCES DireccionUsuario(direccion_usuario_id),
	usuario_telefono decimal(18,0) NULL,
	usuario_fecha_registro datetime2(3) NULL,
	usuario_fecha_nacimiento date NULL
);

/*
CREATE PROCEDURE migrar_usuario
AS
BEGIN
	INSERT INTO Usuario
	(usuario_dni, usuario_nombre, usuario_apellido, usuario_mail, usuario_telefono, usuario_fecha_registro, usuario_fecha_nacimiento)
	SELECT USUARIO_DNI, USUARIO_NOMBRE, USUARIO_APELLIDO, USUARIO_MAIL, USUARIO_TELEFONO, USUARIO_FECHA_REGISTRO, USUARIO_FECHA_NACIMIENTO
	FROM [GD1C2023].[gd_esquema].[Maestra]
	WHERE (USUARIO_DNI is not null and USUARIO_NOMBRE is not null and USUARIO_APELLIDO is not null and USUARIO_MAIL is not null)
	ORDER BY USUARIO_DNI
END
*/

CREATE TABLE Pedido(
	pedido_nro decimal(18,0) IDENTITY PRIMARY KEY, 
	pedido_usuario decimal(18,0) FOREIGN KEY REFERENCES Usuario(usuario_dni), --usuario_dni
	pedido_envio decimal(18,0) FOREIGN KEY REFERENCES Envio(envio_nro), --envio_nro
	pedido_local decimal(18,0) FOREIGN KEY REFERENCES LocalRegistrado(local_id), --local_id
	pedido_medio_de_pago decimal(18,0) FOREIGN KEY REFERENCES MedioDePago(medio_pago_id), --medio_de_pago_id
	pedido_tarifa decimal(18,2) NULL,
	pedido_propina decimal(18,2) NULL,
	pedido_fecha datetime2(3) NULL,
	pedido_tiempo_entrega_estimada decimal(18,2) NULL,
	pedido_fecha_hora_entrega datetime2(3) NULL,
	pedido_observaciones nvarchar(255) NULL,
	pedido_estado decimal(18,0) FOREIGN KEY REFERENCES EstadoPedido(estado_pedido_id), --estado_pedido_id
	pedido_calificacion decimal(18,0) NULL
);

/*
CREATE PROCEDURE migrar_pedido
AS
BEGIN
	INSERT INTO Pedido
	(pedido_nro, pedido_fecha, pedido_tarifa, pedido_propina, pedido_tiempo_entrega_estimada, pedido_fecha_hora_entrega, pedido_calificacion, pedido_observeciones)
	SELECT PEDIDO_NUMERO, PEDIDO_FECHA, PEDIDO_TARIFA_SERVICIO, PEDIDO_PROPINA, PEDIDO_ENTREGA_ESTIMADA, PEDIDO_FECHA_ENTREGA, PEDIDO_CALIFICACION, PEDIDO_FECHA
	FROM [GD1C2023].[gd_esquema].[Maestra]
	WHERE (PEDIDO_NUMERO is not null and PEDIDO_FECHA is not null)
	ORDER BY PEDIDO_NUMERO
END
*/

CREATE TABLE EstadoPedido(
	estado_pedido_id decimal(18,0) IDENTITY PRIMARY KEY,
	estado_pedido_pedido decimal(18,0) FOREIGN KEY REFERENCES Pedido(pedido_nro)--pedido_nro 
);


CREATE TABLE Repartidor(
	repartidor_dni decimal(18,0) NOT NULL PRIMARY KEY,
	repartidor_movilidad nvarchar(50) NULL,
	repartidor_nombre nvarchar(255) NULL,
	repartidor_apellido nvarchar(255) NULL,
	repartidor_direccion nvarchar(255) NULL,
	repartidor_telefono decimal(18,0) NULL,
	repartidor_mail nvarchar(255),
	repartidor_fecha_nacimiento date NULL
);

/*
CREATE PROCEDURE migrar_repartidor
AS
BEGIN
	INSERT INTO Repartidor 
	(repartidor_dni, repartidor_nombre, repartidor_apellido, repartidor_telefono, repartidor_mail, repartidor_movilidad, repartidor_fecha_nacimiento)
	SELECT REPARTIDOR_DNI, REPARTIDOR_NOMBRE, REPARTIDOR_APELLIDO, REPARTIDOR_TELEFONO, REPARTIDOR_MAIL, REPARTIDOR_TIPO_MOVILIDAD, REPARTIDOR_FECHA_NAC
	FROM [GD1C2023].[gd_esquema].[Maestra]
	WHERE (REPARTIDOR_DNI, REPARTIDOR_NOMBRE, REPARTIDOR_APELLIDO, REPARTIDOR_TELEFONO, REPARTIDOR_MAIL, REPARTIDOR_TIPO_MOVILIDAD, REPARTIDOR_FECHA_NAC is not null)
END
*/

/*CREATE TABLE Movilidad(
	tipo_movilidad_id nvarchar(50) NULL PRIMARY KEY,
	movilidad_nombre varchar(15)
)*/


CREATE TABLE Envio(
	envio_nro decimal(18,0) IDENTITY PRIMARY KEY,
	envio_repartidor decimal(18,0) FOREIGN KEY REFERENCES Repartidor(repartidor_dni),--repartidor_id
	envio_direccion_origen nvarchar(255) NULL,
	envio_direccion_destino nvarchar(255) NULL,
	envio_localidad nvarchar(255) NULL,
	envio_provincia nvarchar(255) NULL,
	envio_precio decimal(18,2) NULL,
	envio_propina decimal(18,2) NULL
);

/*
CREATE PROCEDURE migrar_envio
AS
BEGIN
	INSERT INTO Envio 
	(envio_nro, envio_precio, envio_direccion_origen, envio_direccion_destino, envio_localidad, envio_provincia, envio_propina)
	SELECT (ENVIO_MENSAJERIA_NRO, ENVIO_MENSAJERIA_PRECIO_ENVIO, ENVIO_MENSAJERIA_DIRECCION_ORIGEN, ENVIO_MENSAJERIA_DIRECCION_DESTINO, ENVIO_MENSAJERIA_LOCALIDAD, ENVIO_MENSAJERIA_PROVINCIA, ENVIO_MENSAJERIA_PROPINA)
	FROM [GD1C2023].[gd_esquema].[Maestra]
END
*/


CREATE TABLE ServicioMensajeria(
	servicio_mensajeria_id int NOT NULL PRIMARY KEY,
	servicio_mensajeria_usuario int NOT NULL,
	servicio_mensajeria_medio_pago int,
	servicio_mensajeria_fecha_solicitud int,
	servicio_mensajeria_fecha_finalizacion int,
	servicio_mensajeria_valor_asegurado decimal,
	servicio_mensajeria_valor_seguro decimal,
	--servicio_mensajeria_estado ?,
	servicio_mensajeria_calificacion decimal(18,0),
);

/*
CREATE PROCEDURE migrar_servicio_mensajeria
AS
BEGIN
	INSERT INTO ServicioMensajeria
	(servicio_mensajeria_id , servicio_mensajeria_valor_asegurado, servicio_mensajeria_valor_seguro, servicio_mensajeria_calificacion)
	SELECT ENVIO_MENSAJERIA_NRO, ENVIO_MENSAJERIA_VALOR_ASEGURADO, ENVIO_MENSAJERIA_VALOR_SEGURO, ENVIO_MENSAJERIA_CALIFICACION 
	FROM [GD1C2023].[gd_esquema].[Maestra]
END
*/


CREATE TABLE Paquete(
	paquete_id int IDENTITY PRIMARY KEY,
	paquete_tipo nvarchar(50) NULL,
	paquete_alto_max decimal(18,2) NULL,
	paquete_ancho_max decimal(18,2) NULL,
	paquete_largo_max decimal(18,2) NULL,
	paquete_peso_max decimal(18,2) NULL,
	paquete_tipo_precio decimal(18,2) NULL
);

/*
CREATE PROCEDURE migrar_paquete
AS
BEGIN
	INSERT INTO Paquete
	(paquete_tipo, paquete_alto_max, paquete_ancho_max, paquete_largo_max, paquete_peso_max, paquete_tipo_precio)
	SELECT PAQUETE_TIPO, PAQUETE_ALTO_MAX, PAQUETE_ANCHO_MAX, PAQUETE_LARGO_MAX, PAQUETE_PESO_MAX, PAQUETE_TIPO_PRECIO 
	FROM [GD1C2023].[gd_esquema].[Maestra]
END
*/

CREATE TABLE TipoPaquete(
	tipo_paquete_id int NOT NULL PRIMARY KEY,
	tipo_paquete_nombre varchar(15)
);

CREATE TABLE MedioDePago(
	medio_pago_id decimal(18,0) IDENTITY PRIMARY KEY,
	medio_pago_usuario decimal(18,0) FOREIGN KEY REFERENCES Usuario(usuario_dni),--usuario_dni
	medio_pago_tipo nvarchar(50) NULL,
	medio_pago_tarjeta decimal(18,0) FOREIGN KEY REFERENCES Tarjeta(tarjeta_id)--
);

/*
CREATE PROCEDURE migrar_medio_pago
AS
BEGIN
	INSERT INTO MedioDePago
	(medio_pago_tipo)
	SELECT MEDIO_PAGO_TIPO
	FROM [GD1C2023].[gd_esquema].[Maestra]
END
*/

CREATE TABLE Tarjeta(
	tarjeta_id decimal(18,0) IDENTITY PRIMARY KEY,
	tarjeta_nro nvarchar(100) NULL,
	tarjeta_marca nvarchar(100) NULL
);

/*
CREATE PROCEDURE migrar_tarjeta
AS
BEGIN
	INSERT INTO Tarjeta
	(tarjeta_nro, tarjeta_marca)
	SELECT MEDIO_PAGO_NRO_TARJETA, MARCA_TARJETA 
	FROM [GD1C2023].[gd_esquema].[Maestra]
END
*/

/*CREATE TABLE tipo_medio_pago(
	tipo_medio_pago_id int NOT NULL PRIMARY KEY,
	tipo_medio_pago_mp int
)*/


CREATE TABLE OperadorReclamo(
	operador_dni decimal(18,0) NOT NULL PRIMARY KEY,
	operador_reclamo int NOT NULL,--reclamo_id
	operador_nombre nvarchar(255) NULL,
	operador_apellido nvarchar(255) NULL,
	operador_telefono decimal(18,0) NULL,
	operador_direccion nvarchar(255) NULL,
	operador_mail Nvarchar(255) NULL,
	operador_fecha_nacimiento date NULL,
);

/*
CREATE PROCEDURE migrar_operador_reclamo
AS
BEGIN
	INSERT INTO OperadorReclamo
	(operador_dni, operador_nombre, operador_apellido, operador_telefono, operador_direccion, operador_mail, operador_fecha_nacimiento)
	SELECT OPERADOR_DNI, OPERADOR_NOMBRE, OPERADOR_APELLIDO, OPERADOR_TELEFONO, OPERADOR_DIRECCION, OPERADOR_MAIL, OPERADOR_FECHA_NAC
	FROM [GD1C2023].[gd_esquema].[Maestra]
END
*/

CREATE TABLE Reclamo(
	reclamo_id decimal(18,0) PRIMARY KEY,
	reclamo_pedido decimal(18,0) FOREIGN KEY REFERENCES Pedido(pedido_nro),--pedido_id
	reclamo_usuario decimal(18,0) FOREIGN KEY REFERENCES Usuario(usuario_dni),--usuario_dni
	reclamo_tipo nvarchar(50) NULL,
	reclamo_descripcion nvarchar(255) NULL,
	reclamo_fecha_hora_creacion datetime2(3) NULL,
	reclamo_operador decimal(18,0) FOREIGN KEY REFERENCES OperadorReclamo(operador_dni),--operador_id
	reclamo_estado nvarchar(50) NULL,
	reclamo_solucion nvarchar(255) NULL,
	reclamo_fecha_hora_solucion datetime2(3) NULL,
	reclamo_calificacion decimal(18,0) NULL,
);

/*
CREATE PROCEDURE migrar_reclamo
AS
BEGIN
	INSERT INTO Reclamo
	(reclamo_id, reclamo_tipo, reclamo_descripcion, reclamo_fecha_hora_creacion, reclamo_solucion, reclamo_fecha_hora_solucion, reclamo_calificacion)
	SELECT RECLAMO_NRO, RECLAMO_TIPO, RECLAMO_DESCRIPCION, RECLAMO_FECHA, RECLAMO_SOLUCION, RECLAMO_FECHA_SOLUCION, RECLAMO_CALIFICACION
	FROM [GD1C2023].[gd_esquema].[Maestra]
END
*/

/*CREATE TABLE EstadoReclamo(
	estado_reclamo_id decimal(18,0) NOT NULL PRIMARY KEY,
	estado_reclamo_reclamo int NOT NULL--reclamo_id 
)*/

CREATE TABLE Cupon(
	cupon_nro decimal(18,0) IDENTITY PRIMARY KEY,
	cupon_usuario decimal(18,0) FOREIGN KEY REFERENCES Usuario(usuario_dni), --usuario_dni
	cupon_tipo nvarchar(50) NULL,
	cupon_monto_descuento decimal(18,2) NULL,
	cupon_fecha_alta datetime2(3) NULL,
	cupon_fecha_vencimiento datetime2(3) NULL,
);

/*
CREATE PROCEDURE migrar_cupon
AS
BEGIN
	INSERT INTO Cupon
	(cupon_id, cupon_tipo, cupon_monto_descuento, cupon_fecha_alta, cupon_fecha_vencimiento)
	SELECT CUPON_NRO, CUPON_TIPO. CUPON_MONTO, CUPON_FECHA_ALTA, CUPON_FECHA_VENCIMIENTO
	FROM [GD1C2023].[gd_esquema].[Maestra]
END
*/

CREATE TABLE CuponPedido(
	cupon_pedido_id decimal(18,0) IDENTITY PRIMARY KEY,
	cupon_pedido_pedido decimal(18,0) FOREIGN KEY REFERENCES Pedido(pedido_nro), --pedido_nro
);

CREATE TABLE CuponReclamo(
	cupon_reclamo_nro decimal(18,0) NOT NULL PRIMARY KEY,
	cupon_reclamo_usuario decimal(18,0) FOREIGN KEY REFERENCES Usuario(usuario_dni), --usuario_dni
	cupon_reclamo_tipo nvarchar(50) NULL,
	cupon_reclamo_monto decimal(18,2) NULL,
	cupon_reclamo_fecha_alta datetime2(3) NULL,
	cupon_reclamo_fecha_vencimiento datetime2(3) NULL,
);

/*
CREATE PROCEDURE migrar_cupon_reclamo
AS
BEGIN
	INSERT INTO CuponReclamo
	(cupon_reclamo_id, cupon_reclamo_tipo, cupon_reclamo_monto_descuento, cupon_reclamo_fecha_alta, cupon_reclamo_fecha_vencimiento)
	SELECT CUPON_RECLAMO_NRO, CUPON_RECLAMO_TIPO. CUPON_RECLAMO_MONTO, CUPON_RECLAMO_FECHA_ALTA, CUPON_RECLAMO_FECHA_VENCIMIENTO
	FROM [GD1C2023].[gd_esquema].[Maestra]
END
*/

CREATE TABLE LocalRegistrado(
	local_id decimal(18,0) IDENTITY PRIMARY KEY,
	local_nombre nvarchar(100) NULL,
	local_tipo nvarchar(50) NULL,
	local_descripcion nvarchar(255) NULL,
	local_direccion nvarchar(255) NULL,
	local_atencion int NOT NULL
);

/*
CREATE PROCEDURE migrar_local
AS
BEGIN
	INSERT INTO LocalRegistrado
	(local_nombre, local_tipo, local_descripcion, local_direccion)
	SELECT LOCAL_NOMBRE, LOCAL_TIPO, LOCAL_DESCRIPCION, LOCAL_DIRECCION
	FROM [GD1C2023].[gd_esquema].[Maestra]
END
*/

CREATE TABLE TipoLocal(
	tipo_local_id decimal(18,0) NOT NULL PRIMARY KEY,
	tipo_local_nombre varchar(15)
);

CREATE TABLE Categoria(
	categoria_local_id int NOT NULL PRIMARY KEY,
	categoria_local_tipo int NOT NULL,--tipo_local_id 
	categoria_local_nombre varchar(15)
);

CREATE TABLE DiasHoraAtencion(
	atencion_id int NOT NULL PRIMARY KEY,
	atencion_dias_semana ?,
	atencion_horario_apertura time,
	atencion_horario_cierre time
);

CREATE TABLE ProductoLocal(
	producto_codigo nvarchar(50) IDENTITY PRIMARY KEY NOT NULL,
	producto_nombre nvarchar(50) NULL,
	producto_descripcion nvarchar(255) NULL,
	producto_local decimal(18,0) FOREIGN KEY REFERENCES LocalRegistrado(local_id) NOT NULL,--local_id
	producto_cantidad decimal(18,0),
	producto_precio_unitario decimal(18,2),
);

/*
CREATE PROCEDURE migrar_producto_local
AS
BEGIN
	INSERT INTO ProductoLocal
	(producto_codigo, producto_nombre, producto_descripcion, producto_cantidad, producto_precio_unitario)
	SELECT PRODUCTO_LOCAL_CODIGO, PRODUCTO_LOCAL_NOMBRE, PRODUCTO_LOCAL_DESCRIPCION, PRODUCTO_CANTIDAD, PRODUCTO_LOCAL_PRECIO
	FROM [GD1C2023].[gd_esquema].[Maestra]
END
*/

CREATE TABLE DireccionUsuario(
	direccion_usuario_id decimal(18,0) IDENTITY PRIMARY KEY NOT NULL,
	direccion_usuario_usuario decimal(18,0) FOREIGN KEY REFERENCES Usuario(usuario_dni), 
	direccion_usuario_nombre nvarchar(50) NULL,
	direccion_usuario_direccion nvarchar(255) NULL,
	direccion_usuario_localidad nvarchar(255) NULL,
	direccion_usuario_provincia nvarchar(255) NULL
);


/*
CREATE PROCEDURE migrar_direccion_usuario
AS
BEGIN
	INSERT INTO Direccion
	(direccion_usuario_nombre, direccion_usuario_direccion, direccion_usuario_localidad, direccion_usuario_provincia)
	SELECT DIRECCION_USUARIO_NOMBRE, DIRECCION_USUARIO_DIRECCION, DIRECCION_USUARIO_LOCALIDAD, DIRECCION_USUARIO_PROVINCIA 
	FROM [GD1C2023].[gd_esquema].[Maestra]
END
*/


/*
CREATE TABLE Localidad(
	localidad_id int NOT NULL PRIMARY KEY,
	localidad_provincia int NOT NULL,--provincia_id
	localidad_nombre varchar(40)
);

CREATE TABLE Provincia(
	provincia_id int NOT NULL PRIMARY KEY,
	provincia_localidad int NOT NULL
);
*/